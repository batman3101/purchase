# PO 번호 생성 규칙 변경 완료

**날짜**: 2025-01-04
**작업**: PO 번호 생성 로직 개선

---

## 📋 변경 내용

### 이전 방식
```
PO-1001, PO-1002, PO-1003, ...
```
- 순차적으로 증가하는 단순 번호
- 날짜 정보 없음
- 언제 생성되었는지 번호만으로 파악 불가

### 새로운 방식
```
PO-20250104001, PO-20250104002, PO-20250105001, ...
```
- **날짜 기반 번호 생성**
- **매일 001부터 시작**
- 번호만 보고 생성일 즉시 확인 가능

---

## 🎯 새로운 PO 번호 규칙

### 형식
```
PO-YYYYMMDD###
```

### 구성 요소
- **PO-**: 발주서(Purchase Order) 접두사
- **YYYYMMDD**: 생성 날짜 (베트남 시간 기준, GMT+7)
  - YYYY: 년도 (4자리)
  - MM: 월 (2자리, 01-12)
  - DD: 일 (2자리, 01-31)
- **###**: 당일 순번 (3자리, 001-999)

### 예시
| PO 번호 | 의미 |
|---------|------|
| `PO-20250104001` | 2025년 1월 4일 첫 번째 PO |
| `PO-20250104002` | 2025년 1월 4일 두 번째 PO |
| `PO-20250104010` | 2025년 1월 4일 열 번째 PO |
| `PO-20250105001` | 2025년 1월 5일 첫 번째 PO (새로운 날짜로 리셋) |

---

## ✨ 주요 특징

### 1. 자동 날짜 갱신
- **매일 자정**이 지나면 자동으로 새로운 날짜로 시작
- 수동 설정 불필요
- 시간대: 베트남(Asia/Ho_Chi_Minh, GMT+7) 기준

### 2. 당일 순번 관리
- 같은 날짜 내에서는 001, 002, 003... 순차 증가
- 최대 999개까지 생성 가능 (하루에)
- 중간 번호 삭제되어도 순번은 계속 증가

### 3. 일관성 보장
- 베트남 시간대로 고정
- 사용자의 위치/브라우저 시간대와 무관
- 모든 사용자가 동일한 번호 체계 사용

---

## 🔧 구현 상세

### 새로 추가된 함수

#### `getNextPOId(sheet)`
**위치**: Code.gs Line 1186-1230

**기능**:
- PO_List 시트에서 오늘 날짜의 마지막 PO 번호 조회
- 다음 순번 계산 및 생성
- 3자리 패딩 처리 (001, 002, ...)

**로직**:
```javascript
1. 오늘 날짜를 YYYYMMDD 형식으로 가져오기
2. 시트에서 "PO-YYYYMMDD"로 시작하는 모든 ID 찾기
3. 마지막 시퀀스 번호 확인
4. +1 하고 3자리로 패딩
5. 새 PO ID 반환
```

**예시**:
```javascript
// 오늘이 2025-01-04이고, 이미 PO-20250104003까지 생성된 경우
const nextId = getNextPOId(sheet);
// 결과: "PO-20250104004"

// 오늘이 2025-01-05이고, 아직 PO가 없는 경우
const nextId = getNextPOId(sheet);
// 결과: "PO-20250105001"
```

---

## 🧪 테스트 함수

### 1. `testPOIdGeneration()`
**목적**: PO ID 생성 로직 검증

**실행 방법**:
1. Apps Script 편집기 열기
2. 상단 메뉴 > **실행** > **testPOIdGeneration** 선택
3. 로그 확인: **보기** > **로그**

**테스트 내용**:
- ✅ 올바른 날짜 형식인지 확인
- ✅ 시퀀스 번호가 3자리인지 확인
- ✅ 숫자 형식인지 확인

**출력 예시**:
```
========== PO ID 생성 테스트 시작 ==========
✅ 생성된 첫 번째 PO ID: PO-20250104001
📅 오늘 날짜 (YYYYMMDD): 20250104
✅ PO ID가 올바른 날짜 형식을 포함하고 있습니다: PO-20250104
🔢 추출된 시퀀스 번호: 001
✅ 시퀀스 번호가 3자리 숫자 형식입니다
========== PO ID 생성 테스트 완료 ==========

💡 참고:
- 실제 PO를 생성하면 시퀀스 번호가 자동으로 증가합니다
- 다음 날이 되면 자동으로 새로운 날짜로 001부터 시작합니다
- 오늘 생성되는 PO 번호: PO-20250104001, PO-20250104002, ...
```

### 2. `simulatePOIdGeneration()`
**목적**: 실제 생성 없이 미리 확인

**실행 방법**:
1. Apps Script 편집기 > **실행** > **simulatePOIdGeneration**
2. 로그 확인

**출력 예시**:
```
========== PO ID 생성 시뮬레이션 ==========
📅 기준 날짜: 20250104

오늘 생성 가능한 PO ID 예시:
  1. PO-20250104001
  2. PO-20250104002
  3. PO-20250104003
  4. PO-20250104004
  5. PO-20250104005

💡 참고: 위 ID들은 시뮬레이션이며 실제로 생성되지 않았습니다
```

### 3. `checkCurrentPOIds()`
**목적**: 현재 PO 현황 조회

**실행 방법**:
1. Apps Script 편집기 > **실행** > **checkCurrentPOIds**
2. 로그 확인

**출력 예시**:
```
========== 현재 PO ID 현황 ==========
📅 오늘 날짜: 20250104

✅ 오늘 생성된 PO: 3개
  - PO-20250104001
  - PO-20250104002
  - PO-20250104003

🔮 다음 생성될 PO ID: PO-20250104004
```

---

## 📝 수정된 파일

### 1. Code.gs
**추가된 함수**:
- `getNextPOId(sheet)` - Line 1186-1230
- `testPOIdGeneration()` - Line 1612-1658
- `simulatePOIdGeneration()` - Line 1664-1689
- `checkCurrentPOIds()` - Line 1694-1736

**수정된 함수**:
- `addPO(formData)` - Line 1391
  - `getNextId(sheet, "PO-")` → `getNextPOId(sheet)` 변경

**추가된 상수**:
- `ID_GENERATION.PO_SEQUENCE_LENGTH: 3` - Line 27

### 2. CLAUDE.md
- ID 생성 패턴 섹션 업데이트 (Line 52-74)
- 유틸리티 함수 목록에 `getNextPOId()` 추가 (Line 115)

---

## 🎓 사용 가이드

### 일반 사용자
- **변경 사항 없음**: PO 생성 UI는 동일
- 자동으로 새로운 형식의 번호 생성
- 기존 PO와 새 PO가 공존 가능

### 개발자
1. **테스트 실행**
   ```
   Apps Script 편집기 > 실행 > testPOIdGeneration
   ```

2. **디버깅**
   ```javascript
   Logger.log(getNextPOId(sheet));  // 다음 번호 확인
   ```

3. **시퀀스 길이 변경** (필요시)
   ```javascript
   // Code.gs Line 27
   ID_GENERATION.PO_SEQUENCE_LENGTH: 4  // 0001, 0002, ...
   ```

---

## ⚠️ 주의사항

### 1. 기존 PO와의 호환성
- ✅ **기존 PO 번호는 그대로 유지**됩니다
- ✅ 조회, 삭제 등 모든 기능 정상 작동
- ⚠️ 새로 생성되는 PO만 새 형식 적용

### 2. 시간대 설정
- 베트남 시간(GMT+7) 고정
- 다른 국가에서 사용 시 시간대 확인 필요
- 변경 필요 시: `'Asia/Ho_Chi_Minh'` → 원하는 시간대

### 3. 하루 최대 생성 수
- 이론적 최대: 999개 (001-999)
- 999개 초과 시 시퀀스 길이 확장 필요
- 일반적 사용에는 충분

---

## 🔄 롤백 방법

만약 이전 방식으로 되돌려야 하는 경우:

### Code.gs Line 1391 수정
```javascript
// 현재 (새 방식)
const newId = getNextPOId(sheet);

// 이전 방식으로 변경
const newId = getNextId(sheet, "PO-");
```

---

## 📊 변경 이력

| 버전 | 날짜 | 변경 내용 |
|------|------|-----------|
| v2.0 | 2025-01-04 | 날짜 기반 PO 번호 도입 |
| v1.0 | 이전 | 순차 증가 번호 (PO-1001, ...) |

---

## 💡 향후 개선 가능 사항

### 1. 자동 백업
```javascript
// 매일 자정에 전날 PO 백업
function dailyPOBackup() {
  const yesterday = new Date();
  yesterday.setDate(yesterday.getDate() - 1);
  const dateStr = Utilities.formatDate(yesterday, 'Asia/Ho_Chi_Minh', 'yyyyMMdd');
  // 백업 로직...
}
```

### 2. 통계 대시보드
```javascript
// 일별 PO 생성 통계
function getDailyPOStats(dateStr) {
  const prefix = `PO-${dateStr}`;
  // 해당 날짜의 PO 개수 계산...
}
```

### 3. 알림 기능
```javascript
// 하루 PO 생성 수가 많을 때 알림
if (todayPOCount > 50) {
  // 관리자에게 이메일 발송...
}
```

---

## ✅ 체크리스트

배포 전 확인사항:

- [x] `getNextPOId()` 함수 구현 완료
- [x] `addPO()` 함수에 적용 완료
- [x] 테스트 함수 3개 작성 완료
- [x] 문서화 완료 (CLAUDE.md)
- [x] 상수 정의 완료
- [ ] 실제 환경에서 테스트 (배포 후)
- [ ] 사용자 교육 자료 배포 (필요시)

---

## 🎊 완료!

PO 번호 생성 규칙이 성공적으로 날짜 기반 방식으로 변경되었습니다!

**핵심 개선사항**:
- ✅ 번호만으로 생성일 확인 가능
- ✅ 매일 자동 리셋
- ✅ 일관된 시간대 관리
- ✅ 완전한 하위 호환성
- ✅ 테스트 함수 제공

**다음 단계**:
1. Apps Script 편집기에서 `testPOIdGeneration()` 실행
2. 로그 확인하여 정상 작동 확인
3. 실제 PO 생성하여 번호 확인
4. 다음날 다시 테스트하여 날짜 리셋 확인

문의사항이나 추가 요구사항이 있으시면 언제든지 말씀해주세요!
